"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.iterator"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.addBabel=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_api=require("../api");const BABEL_CORE=["@babel/cli","@babel/core","@babel/runtime"],BABEL_PRESETS=["@babel/preset-env","babel-preset-minify"],BABEL_PLUGINS=["@babel/plugin-transform-runtime","@babel/plugin-proposal-class-properties","@babel/plugin-proposal-export-default-from","@babel/plugin-proposal-optional-chaining"],BABEL_REACT_PLUGINS=["react-hot-loader"],BABEL_REACT_PRESETS=["@babel/preset-react"],BABEL_DEPENDENCIES=[...BABEL_CORE,...BABEL_PRESETS,...BABEL_PLUGINS],SNOWPACK_DEPENDENCIES=["snowpack","@snowpack/app-scripts-react","@snowpack/plugin-react-refresh","@snowpack/plugin-postcss","@snowpack/plugin-optimize"],addBabel=[{text:"Create Babel config file",task:function(){var _ref=(0,_asyncToGenerator2.default)(function*(){yield new _api.BabelConfigModuleEditor().create().commit()});return function task(){return _ref.apply(this,arguments)}}(),condition:()=>(0,_api.allDoNotExist)("babel.config.js",".babelrc",".babelrc.js")},{text:"Create Snowpack config and Configure Babel for Snowpack",task:function(){var _ref2=(0,_asyncToGenerator2.default)(function*({useSnowpack}){yield new _api.SnowpackConfigEditor().create().commit(),yield new _api.BabelConfigModuleEditor().extend(useSnowpack?{extends:`'@snowpack/app-scripts-react/babel.config.json'`,plugins:`[]`,presets:`[]`,env:{development:{plugins:`['react-refresh/babel']`}}}:{}).commit()});return function task(){return _ref2.apply(this,arguments)}}(),condition:({useSnowpack})=>useSnowpack&&(0,_api.allDoExist)("babel.config.js"),optional:({useSnowpack})=>useSnowpack},{text:"Add React support to Babel configuration file",task:function(){var _ref3=(0,_asyncToGenerator2.default)(function*({useRollup}){const addQuotes=str=>`'${str}'`,maybeRename=name=>"react-hot-loader"===name?"react-hot-loader/babel":name,plugins=[...BABEL_REACT_PLUGINS,...BABEL_PLUGINS].filter(name=>!useRollup||"react-hot-loader"!==name).map(name=>{var _ref4,_name;return _ref4=(_name=name,maybeRename(_name)),addQuotes(_ref4)}),presets=[...BABEL_PRESETS].map(addQuotes).concat([[`'@babel/preset-react'`,{runtime:`'automatic'`}]]);yield new _api.BabelConfigModuleEditor().extend({plugins,presets}).commit()});return function task(){return _ref3.apply(this,arguments)}}(),condition:({useReact,useSnowpack})=>useReact&&!useSnowpack&&(0,_api.allDoExist)("babel.config.js"),optional:({useReact,useSnowpack})=>useReact&&!useSnowpack},{text:"Add Babel build task to package.json",task:function(){var _ref5=(0,_asyncToGenerator2.default)(function*({outputDirectory,sourceDirectory,useSnowpack}){yield new _api.PackageJsonEditor().extend(useSnowpack?{scripts:{build:"snowpack build"}}:{scripts:{"build:es":`babel ${sourceDirectory} --out-dir ${outputDirectory}`,"watch:es":`watch 'npm run build:es' ${sourceDirectory}`}}).commit()});return function task(){return _ref5.apply(this,arguments)}}(),condition:()=>(0,_api.allDoExist)("package.json")},{text:"Install Babel core, CLI, presets, and plugins",task:({skipInstall})=>(0,_api.install)(BABEL_DEPENDENCIES,{dev:!0,skipInstall}),condition:({skipInstall,useSnowpack})=>!useSnowpack&&!skipInstall&&!new _api.PackageJsonEditor().hasAll(...BABEL_DEPENDENCIES)&&(0,_api.allDoExist)("package.json"),// eslint-disable-line max-len
optional:({useSnowpack})=>!useSnowpack},{text:"Install Babel React presets and plugins",task:({skipInstall})=>(0,_api.install)([...BABEL_REACT_PRESETS,...BABEL_REACT_PLUGINS],{dev:!0,skipInstall}),condition:({skipInstall,useReact,useSnowpack})=>!useSnowpack&&!skipInstall&&useReact&&(0,_api.allDoExist)("package.json"),// eslint-disable-line max-len
optional:({useReact,useSnowpack})=>useReact&&!useSnowpack},{text:"Install Snowpack dependencies",task:({skipInstall})=>(0,_api.install)(SNOWPACK_DEPENDENCIES,{dev:!0,skipInstall}),condition:({skipInstall,useSnowpack})=>!skipInstall&&useSnowpack&&!new _api.PackageJsonEditor().hasAll(...SNOWPACK_DEPENDENCIES)&&(0,_api.allDoExist)("package.json"),// eslint-disable-line max-len
optional:({useSnowpack})=>useSnowpack}];exports.addBabel=addBabel;var _default=addBabel;exports.default=_default;